<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Grayscale ASCII Fire</title>
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      overflow: hidden;
      color: #fff;
      font-family: monospace;
    }

    /* The ASCII Display */
    #fire {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      white-space: pre;
      font-size: 10px;
      line-height: 8px;
      pointer-events: none;
      text-align: center;
    }

    /* Control Panel */
    #controls {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 100;
      background: rgba(40, 40, 40, 0.8);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #444;
      backdrop-filter: blur(5px);
      font-family: sans-serif;
      font-size: 12px;
    }

    .control-group {
      margin-bottom: 10px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: #aaa;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    input[type=range] {
      width: 150px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <div id="controls">
    <div class="control-group">
      <label>Fire Intensity (Fuel)</label>
      <input type="range" id="intensity" min="0" max="35" value="35">
    </div>
    <div class="control-group">
      <label>Fire Height (Decay)</label>
      <input type="range" id="decay" min="1" max="5" step="0.1" value="2">
    </div>
  </div>

  <pre id="fire"></pre>

  <script>
    const fireElement = document.getElementById('fire');
    const intensitySlider = document.getElementById('intensity');
    const decaySlider = document.getElementById('decay');

    // ASCII characters sorted by visual weight (density)
    const charSet = " .:-=+*#%@▒▓█".split("");

    // Grayscale palette (36 levels from black to white)
    const colors = [];
    for (let i = 0; i < 36; i++) {
      const val = Math.floor((i / 35) * 255);
      colors.push(`rgb(${val},${val},${val})`);
    }

    let firePixels = [];
    let width = 0;
    let height = 50; // Total vertical lines

    function init() {
      // Calculate width based on character size (~6px per char)
      width = Math.floor(window.innerWidth / 6);
      firePixels = new Array(width * height).fill(0);
    }

    function step() {
      const fuel = parseInt(intensitySlider.value);
      const decayRate = parseFloat(decaySlider.value);

      // 1. Update the "Source" (bottom row) with the Fuel setting
      for (let i = 0; i < width; i++) {
        firePixels[(height - 1) * width + i] = fuel;
      }

      // 2. Propagate heat upwards
      for (let x = 0; x < width; x++) {
        for (let y = 1; y < height; y++) {
          const srcIdx = y * width + x;
          const pixel = firePixels[srcIdx];

          if (pixel === 0) {
            firePixels[srcIdx - width] = 0;
          } else {
            // Higher decay = shorter fire
            const decay = Math.floor(Math.random() * decayRate);
            const drift = Math.floor(Math.random() * 3) - 1;
            const dstIdx = (srcIdx - width) + drift;

            if (dstIdx >= 0) {
              firePixels[dstIdx] = Math.max(0, pixel - decay);
            }
          }
        }
      }
      render();
    }

    function render() {
      let output = "";
      // We use a <span> for each character to apply its specific gray color
      // However, for performance, we'll build a raw text string first.
      // Note: In grayscale, density (the character) does most of the work.

      for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
          const intensity = firePixels[y * width + x];
          if (intensity === 0) {
            output += " ";
          } else {
            // Map 0-35 intensity to 0-12 charSet index
            const charIdx = Math.floor((intensity / 35) * (charSet.length - 1));
            output += charSet[charIdx];
          }
        }
        output += "\n";
      }
      fireElement.textContent = output;
    }

    window.addEventListener('resize', init);
    init();

    // Run at 30 FPS for that retro feel
    setInterval(step, 33);
  </script>
</body>

</html>
